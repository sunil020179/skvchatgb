<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SKVChatGB ‚Äì Build delightful chat experiences</title>
  <meta name="description" content="A fast, secure and customizable AI chatbot for your website, WhatsApp, and support inbox.">
  <style>
    :root{
      --bg:#0b1021; --fg:#e5e7eb; --muted:#9aa0aa; --card:#0f1530;
      --brand:#6ea8fe; --btn:#111827; --white:#fff; --chip:#eef2ff;
      --shadow:0 10px 40px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--fg)}
    a{color:inherit;text-decoration:none}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;gap:10px;align-items:center}
    .brand .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#6ea8fe,#9b8cff)}
    .nav a.btn{padding:10px 14px;border-radius:10px;background:#1f2937}
    .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:20px;align-items:center;margin-top:20px}
    @media (max-width:900px){.hero{grid-template-columns:1fr}}
    .title{font-weight:700;line-height:1.1;font-size:clamp(28px,5vw,44px)}
    .subtitle{color:var(--muted);margin-top:10px}
    .cta{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap}
    .cta .btn{padding:12px 16px;border-radius:12px;border:none;cursor:pointer}
    .btn.primary{background:var(--brand);color:#0b1021;font-weight:600;box-shadow:var(--shadow)}
    .btn.secondary{background:#1f2937;color:#fff}
    .chip{display:inline-flex;gap:8px;align-items:center;background:var(--chip);color:#1f2937;padding:6px 10px;border-radius:999px;font-size:12px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,0.06);border-radius:16px;box-shadow:var(--shadow)}
    .demo{padding:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .select,input,textarea,button{font:inherit}
    select,input,textarea{background:#0e1636;color:var(--fg);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px}
    textarea{width:100%;min-height:110px;resize:vertical}
    .status{font-size:12px;color:var(--muted)}
    .chatwrap{padding:14px}
    .bubble{background:#101a3f;border:1px solid rgba(255,255,255,.06);padding:10px 12px;border-radius:12px;max-width:95%}
    .chat{display:flex;flex-direction:column;gap:10px;max-height:360px;overflow:auto;padding:8px}
    .chat .me{align-items:flex-end;display:flex}
    .chat .bot{align-items:flex-start;display:flex}
    .chat .me .bubble{background:#1b2a68}
    .inpbar{display:flex;gap:10px;margin-top:10px}
    .send{background:#111827;color:#fff;border:none;border-radius:12px;padding:10px 14px;cursor:pointer}
    .contact{display:flex;gap:10px;align-items:center}
    .contact .whatsapp{display:inline-flex;gap:8px;align-items:center;background:#25D366;color:#0b1021;padding:8px 12px;border-radius:999px;font-weight:600}
    footer{opacity:.7;font-size:12px;margin:22px 0}
  </style>
</head>
<body>
  <div class="container">
    <!-- Top Nav -->
    <div class="nav">
      <div class="brand">
        <div class="logo"></div>
        <b>SKVChatGB</b>
      </div>
      <div class="row">
        <a class="btn" href="#features">Features</a>
        <a class="btn" href="#pricing">Pricing</a>
        <a class="btn" href="#contact">Contact</a>
        <a class="btn" href="mailto:hello@skvchatgb.com">Talk to Sales</a>
      </div>
    </div>

    <!-- Hero -->
    <section class="hero">
      <div>
        <span class="chip">NEW ‚Äì v1.0</span>
        <h1 class="title">Build delightful chat experiences with <span style="color:#9b8cff">SKVChatGB</span></h1>
        <p class="subtitle">A fast, secure and customizable AI chatbot for your website, WhatsApp, and support inbox‚Äîno code required.</p>
        <div class="cta">
          <a class="btn primary" href="#live">Get Started</a>
          <a class="btn secondary" href="#features">See Features</a>
        </div>
        <div class="contact" style="margin-top:14px">
          <span class="chip" id="contactBadge">üìû +971-5X-XXX-XXXX ‚Ä¢ support@skvchatgb.com</span>
          <a class="whatsapp" id="waLink" target="_blank" rel="noopener">WhatsApp Us</a>
        </div>
      </div>

      <!-- Live Demo Card -->
      <div class="card demo" id="live">
        <div class="row" style="justify-content:space-between">
          <b>Live Demo</b>
          <div class="row">
            <select id="countrySelect" class="select">
              <!-- Populated by JS -->
            </select>
            <span class="chip">üåç <b id="cc">AE</b></span>
          </div>
        </div>

        <div class="chatwrap">
          <div class="chat" id="chat">
            <div class="bot"><div class="bubble">Hi! I am SKVChatGB. How can I help you today?</div></div>
          </div>

          <div class="inpbar">
            <input id="user" placeholder="Type a message..." style="flex:1" />
            <button class="send" id="send">Send</button>
          </div>
          <div class="status" id="status"></div>
        </div>
      </div>
    </section>

    <footer>¬© <span id="yr"></span> SKVChatGB. All rights reserved.</footer>
  </div>

  <script>
    // --- Country config inline (‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§Ü‡§™ countries.json ‡§∏‡•á ‡§≠‡•Ä ‡§≤‡•ã‡§° ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç) ---
    const CFG = {
      defaultCountry: "AE",
      countries: {
        "AE": {
          name: "United Arab Emirates",
          lang: "en",  // ‡§Ü‡§™ ‡§ö‡§æ‡§π‡•á‡§Ç ‡§§‡•ã "hi" ‡§ï‡§∞ ‡§¶‡•á‡§Ç
          contact: { phone: "+971-5X-XXX-XXXX", email: "support-ae@skvchatgb.com", whatsapp: "9715XXXXXXXX" },
          system: "You are an assistant for SKV Business Services in UAE. Focus on UAE company setup, VAT(5%), corporate tax, freezones, visa, PRO services. Keep answers concise and helpful.",
          model: "gpt-4o-mini"
        },
        "IN": {
          name: "India",
          lang: "hi",
          contact: { phone: "+91-9X-XXXX-XXXX", email: "support-in@skvchatgb.com", whatsapp: "91XXXXXXXXXX" },
          system: "You are an assistant for SKV Business Services in India. Focus on GST, MCA incorporation, MSME, FSSAI, IEC, and compliance.",
          model: "gpt-4o-mini"
        },
        "SA": {
          name: "Saudi Arabia",
          lang: "ur",
          contact: { phone: "+966-5X-XXX-XXXX", email: "support-sa@skvchatgb.com", whatsapp: "9665XXXXXXXX" },
          system: "You are an assistant for SKV Business Services in KSA. Focus on MISA license, ZATCA e-invoicing, CR, visas, labor rules.",
          model: "gpt-4o-mini"
        },
        "QA": {
          name: "Qatar",
          lang: "en",
          contact: { phone: "+974-5X-XXX-XXXX", email: "support-qa@skvchatgb.com", whatsapp: "9745XXXXXXXX" },
          system: "You are an assistant for SKV Business Services in Qatar. Focus on CR, visas, taxation, free zones, and local compliance.",
          model: "gpt-4o-mini"
        }
      }
    };

    const $ = s => document.querySelector(s);
    const chat = $("#chat");
    const ccEl = $("#cc");
    const statusEl = $("#status");
    const yearEl = $("#yr");
    yearEl.textContent = new Date().getFullYear();

    // Build country dropdown
    const sel = $("#countrySelect");
    Object.entries(CFG.countries).forEach(([code, c]) => {
      const opt = document.createElement("option");
      opt.value = code; opt.textContent = `${c.name} (${code})`;
      sel.appendChild(opt);
    });

    // Determine country from localStorage or default
    function setCountry(code){
      const conf = CFG.countries[code] || CFG.countries[CFG.defaultCountry];
      localStorage.setItem("skvCountry", code);
      document.documentElement.lang = conf.lang || "en";
      ccEl.textContent = code;
      $("#contactBadge").textContent = `üìû ${conf.contact.phone} ‚Ä¢ ${conf.contact.email}`;
      const wa = `https://wa.me/${conf.contact.whatsapp || ""}`;
      const waLink = $("#waLink");
      waLink.href = wa;
      waLink.textContent = "WhatsApp Us";
    }

    // Optional: auto-detect from subdomain (ae., in., sa., qa.)
    (function autoCountryFromSubdomain(){
      const host = location.hostname;
      const sub = host.split(".")[0].toUpperCase();
      if (CFG.countries[sub]) {
        sel.value = sub;
      } else {
        sel.value = localStorage.getItem("skvCountry") || CFG.defaultCountry;
      }
      setCountry(sel.value);
    })();

    sel.addEventListener("change", () => setCountry(sel.value));

    function pushBot(text){
      const row = document.createElement("div"); row.className = "bot";
      const b = document.createElement("div"); b.className = "bubble"; b.textContent = text;
      row.appendChild(b); chat.appendChild(row); chat.scrollTop = chat.scrollHeight;
    }
    function pushMe(text){
      const row = document.createElement("div"); row.className = "me";
      const b = document.createElement("div"); b.className = "bubble"; b.textContent = text;
      row.appendChild(b); chat.appendChild(row); chat.scrollTop = chat.scrollHeight;
    }

    async function send(){
      const msg = $("#user").value.trim();
      if(!msg) return;
      $("#user").value = "";
      pushMe(msg);
      statusEl.textContent = "Connecting...";
      const country = ccEl.textContent.trim();

      // Prefer /api/chat-country; fallback to /api/chat if not present
      let endpoint = "/api/chat-country";
      try {
        const ping = await fetch("/api/health").then(r=>r.ok).catch(()=>false);
        // if /api/health exists but country route 404s, fallback inside catch below
      } catch {}
      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ user: msg, country })
        });
        if(res.status === 404){
          // fallback
          return await sendFallback(msg);
        }
        if (!res.ok || !res.body) {
          const t = await res.text(); statusEl.textContent = "Error";
          pushBot(t || "Server error"); return;
        }
        statusEl.textContent = "Streaming...";
        const reader = res.body.getReader();
        const decoder = new TextDecoder();
        let acc = "";
        while(true){
          const {value, done} = await reader.read();
          if(done) break;
          acc += decoder.decode(value, {stream:true});
        }
        pushBot(acc || ""); statusEl.textContent = "Done";
      } catch (e) {
        await sendFallback(msg);
      }
    }

    async function sendFallback(msg){
      statusEl.textContent = "Fallback...";
      try{
        const res = await fetch("/api/chat", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ user: msg, system: CFG.countries[$("#countrySelect").value].system })
        });
        const text = await res.text();
        pushBot(text || ""); statusEl.textContent = "Done";
      }catch(e){
        pushBot("Unable to reach server."); statusEl.textContent = "Error";
      }
    }

    $("#send").addEventListener("click", send);
    $("#user").addEventListener("keydown", e => {
      if(e.key === "Enter" && !e.shiftKey){ e.preventDefault(); send(); }
    });
  </script>
</body>
</html>
// api/chat-country.js (Vercel serverless function)
export default async function handler(req, res) {
  if (req.method !== 'POST') return res.status(405).send('Method not allowed');
  const { user, country } = req.body || {};
  if (!user) return res.status(400).send('`user` message is required');

  const countryConfigs = {
    AE: { system: "You are assistant for UAE business setup, VAT, freezones." },
    IN: { system: "You are assistant for India GST, MCA incorporation, compliance." },
    SA: { system: "You are assistant for KSA ZATCA, MISA, CR, visas." },
    QA: { system: "You are assistant for Qatar CR, taxation, free zones." }
  };
  const cc = countryConfigs[country] || countryConfigs.AE;

  const r = await fetch("https://api.openai.com/v1/responses", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${process.env.OPENAI_API_KEY}`
    },
    body: JSON.stringify({
      model: process.env.OPENAI_MODEL || "gpt-4o-mini",
      input: [
        { role: "system", content: cc.system },
        { role: "user", content: user }
      ]
    })
  });

  const data = await r.json();
  res.status(200).json(data);
}
